<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="video_subtitle_remover.page_title">è§†é¢‘å»é™¤å­—å¹• - è¤ç«.AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link href="/components/styles.css" rel="stylesheet">
    <link href="/css/video-subtitle-remover.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
    <script src="/translations.js"></script>
    <style>
        
        /* çŠ¶æ€æ ‡ç­¾åŠ¨ç”» */
        .status-processing .ri-loader-4-line {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* çŠ¶æ€æŒ‰é’®æ‚¬åœæ•ˆæœ */
        .check-status-btn:hover {
            transform: scale(1.1);
            transition: transform 0.2s;
        }
        
        /* ä¸Šä¼ åŒºåŸŸæ ·å¼ */
        .upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: border-color 0.3s, background-color 0.3s;
        }
        
        .upload-area:hover {
            border-color: #6366f1;
            background-color: #f8fafc;
        }
        
        .upload-area.dragover {
            border-color: #6366f1;
            background-color: #eef2ff;
        }
    </style>

    <link rel="icon" href="/images/favicon.png" type="image/png">  <script src="/js/auth-check.js"></script>
    <script src="/js/mobile-guard.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- ç®€åŒ–ç‰ˆå¯¼èˆªæ  -->
    <div id="navbar-simple"></div>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="container mx-auto py-8 px-4" style="margin-top: 60px;">
        <h1 class="text-3xl font-bold text-center mb-8" data-translate="video_subtitle_remover.title">å­—å¹•å»é™¤æ•ˆæœ</h1>
        
        <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
            <!-- å·¦ä¾§é¢æ¿: ä¸Šä¼ è§†é¢‘å’Œè®¾ç½® -->
            <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-bold mb-4" data-translate="video_subtitle_remover.upload_video">ä¸Šä¼ è§†é¢‘</h2>
                
                <div id="upload-area" class="upload-area h-36 flex flex-col items-center justify-center mb-2 bg-gray-50">
                            <i class="ri-upload-cloud-line text-2xl text-gray-400 mb-1"></i>
                    <p class="text-gray-500 text-center text-sm px-2" data-translate="video_subtitle_remover.upload_hint">ç‚¹å‡»æˆ–è€…æ‹–åŠ¨è§†é¢‘æ–‡ä»¶åˆ°è¿™åŒºåŸŸæ¥ä¸Šä¼ </p>
                            <input type="file" id="video-upload" class="hidden" accept="video/mp4">
                        </div>
                <p class="text-xs text-gray-500 mb-2" data-translate="video_subtitle_remover.file_format">æ”¯æŒMP4æ ¼å¼ï¼Œå¤§å°ä¸è¶…è¿‡200MB</p>
                        
                        <!-- æ·»åŠ è§†é¢‘æ—¶é•¿å’Œç§¯åˆ†æ¶ˆè€—ä¿¡æ¯ -->
                        <div id="video-duration-info" class="hidden p-3 bg-blue-50 text-blue-700 rounded-md mb-4 text-sm">
                            <span data-translate="video_subtitle_remover.video_duration">è§†é¢‘æ—¶é•¿</span>: <span data-translate="video_subtitle_remover.calculating">è®¡ç®—ä¸­...</span>
                        </div>

                        <!-- æ·»åŠ ç§¯åˆ†æ‰£é™¤è¯´æ˜ -->
                        <div class="p-3 bg-green-50 text-green-700 rounded-md mb-4 text-sm">
                            <i class="ri-information-line mr-1"></i>
                            <strong data-translate="video_subtitle_remover.credits_deducted_after_success">ç§¯åˆ†å°†åœ¨ä»»åŠ¡æˆåŠŸå®Œæˆåæ‰æ‰£é™¤</strong><span data-translate="video_subtitle_remover.wait_patiently">ï¼Œè¯·è€å¿ƒç­‰å¾…å¤„ç†ç»“æœã€‚ä»»åŠ¡å¤±è´¥ä¸ä¼šæ‰£é™¤ç§¯åˆ†ã€‚</span>
                        </div>

                <div class="mb-6">
                    <h3 class="text-lg font-medium mb-3" data-translate="video_subtitle_remover.usage_instructions">ä½¿ç”¨è¯´æ˜</h3>
                    <div class="text-gray-600 text-sm">
                        <p class="mb-2" data-translate="video_subtitle_remover.step1">1. ä¸Šä¼ ä¸€ä¸ªåŒ…å«å­—å¹•çš„è§†é¢‘æ–‡ä»¶ï¼ˆæ”¯æŒMP4æ ¼å¼ï¼‰</p>
                        <p class="mb-2" data-translate="video_subtitle_remover.step2">2. ç‚¹å‡»â€œå¼€å§‹å¤„ç†â€æŒ‰é’®ï¼Œç­‰å¾…AIå¤„ç†ï¼ˆå¤„ç†æ—¶é—´ä¸è§†é¢‘é•¿åº¦æˆæ­£æ¯”ï¼‰</p>
                        <p class="mb-2" data-translate="video_subtitle_remover.step3">3. å¤„ç†å®Œæˆåï¼Œæ‚¨å¯ä»¥é¢„è§ˆå¹¶ä¸‹è½½æ— å­—å¹•çš„è§†é¢‘</p>
                    </div>
                        </div>
                        
                <div class="mb-6">
                    <h3 class="text-lg font-medium mb-3" data-translate="video_subtitle_remover.notes">æ³¨æ„äº‹é¡¹</h3>
                    <div class="text-gray-600 text-sm">
                        <p class="mb-1" data-translate="video_subtitle_remover.note1">- ç¡¬å­—å¹•ï¼ˆå†…åµŒå­—å¹•ï¼‰å»é™¤æ•ˆæœæ¯”è½¯å­—å¹•æ›´å¥½</p>
                        <p class="mb-1" data-translate="video_subtitle_remover.note2">- æˆåŠŸç‡ä¸è§†é¢‘æ¸…æ™°åº¦ã€å­—å¹•ç±»å‹å’ŒèƒŒæ™¯å¤æ‚åº¦æœ‰å…³</p>
                        <p class="mb-1" data-translate="video_subtitle_remover.note3">- æ”¯æŒå¸¸è§„ä¸­æ–‡/è‹±æ–‡å­—å¹•ï¼Œæ¯”å¦‚çº¯è‰²ç”µå½±å­—å¹•</p>
                        <p class="mb-1" data-translate="video_subtitle_remover.note4">- ä¸æ”¯æŒå¤æ‚çš„èŠ±ä½“å­—å¹•ï¼Œå­—ä½“ç¬”ç”»è¿‡äºçº¤ç»†çš„å­—å¹•</p>
                    </div>
                </div>
                
                <button id="process-btn" class="w-full bg-indigo-600 text-white py-3 rounded-md hover:bg-indigo-700 flex items-center justify-center">
                    <i class="ri-film-line mr-2"></i>
                                <span data-translate="video_subtitle_remover.start_processing">å¼€å§‹å¤„ç†</span>
                            </button>
                <p class="mt-2 text-center text-sm text-gray-500">
                    <span data-translate="video_subtitle_remover.processing_time_note">å¤„ç†æ—¶é—´ä¸è§†é¢‘é•¿åº¦æˆæ­£æ¯”</span>
                </p>
                <p class="mt-1 text-center text-sm text-orange-600 font-medium">
                    <span data-translate="video_subtitle_remover.credit_cost">30 ç§¯åˆ†/30ç§’ï¼ˆä¸æ»¡30ç§’æŒ‰30ç§’è®¡ç®—ï¼‰</span>
                </p>
                
                <div class="mt-4 p-3 bg-red-50 rounded-md">
                    <p class="text-xs text-red-500 font-medium">
                        <span data-translate="video_subtitle_remover.warning_text">è¯·ä¸Šä¼ åˆæ³•åˆè§„çš„å›¾ç‰‡è§†é¢‘ï¼Œå¦‚æœ‰è¿åä¼šè¿›è¡Œå°å·å¤„ç†ï¼Œä»»åŠ¡ä¸€æ—¦æäº¤å°±ä¼šæ‰£é™¤ç§¯åˆ†ä¸å¯ä¸­æ–­ï¼Œè¯·å‹¿é‡å¤åˆ·æ–°æäº¤ï¼Œå¦åˆ™ä¼šé€ æˆç§¯åˆ†æµªè´¹ã€‚</span>
                    </p>
                </div>
                    </div>
                    
            <!-- å³ä¾§é¢æ¿: è§†é¢‘é¢„è§ˆå’Œå†å²è®°å½• -->
            <div class="lg:col-span-3">
                <!-- è§†é¢‘é¢„è§ˆéƒ¨åˆ† -->
                <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                    <h2 class="text-xl font-bold mb-4" data-translate="video_subtitle_remover.video_preview">è§†é¢‘é¢„è§ˆ</h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                            <h3 class="text-lg font-medium mb-3" data-translate="video_subtitle_remover.original_video">åŸè§†é¢‘:</h3>
                            <div class="video-preview mb-4">
                                    <div id="original-video-wrapper" class="video-wrapper hidden w-full h-full relative">
                                        <video id="original-video" class="w-full h-full object-contain" controls></video>
                                    </div>
                                    <p id="original-video-placeholder" class="text-gray-500 text-center px-4" data-translate="video_subtitle_remover.upload_video_hint">ä¸Šä¼ è§†é¢‘åå°†åœ¨è¿™é‡Œæ˜¾ç¤º</p>
                                </div>
                            </div>
                            
                            <div>
                            <h3 class="text-lg font-medium mb-3" data-translate="video_subtitle_remover.processed_video">å¤„ç†åè§†é¢‘:</h3>
                            <div class="video-preview mb-4">
                                    <div id="output-video-wrapper" class="video-wrapper hidden w-full h-full relative">
                                        <video id="output-video" class="w-full h-full object-contain" controls></video>
                                    </div>
                                    <p id="output-video-placeholder" class="text-gray-500 text-center px-4" data-translate="video_subtitle_remover.processing_complete_hint">å¤„ç†å®Œæˆåå°†åœ¨è¿™é‡Œæ˜¾ç¤º</p>
                                </div>
                            </div>
                        </div>
                        
                    <div id="generation-status" class="mt-4 hidden">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium text-gray-700" data-translate="video_subtitle_remover.processing_progress">å¤„ç†è¿›åº¦</span>
                            <span id="status-text" class="text-sm text-indigo-600" data-translate="video_subtitle_remover.processing_status">æ­£åœ¨å¤„ç†...</span>
                            </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div id="progress-bar" class="bg-indigo-600 h-2.5 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-2 justify-end hidden" id="video-actions">
                        <button id="download-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded-md text-sm flex items-center">
                            <i class="ri-download-line mr-1"></i> <span data-translate="video_subtitle_remover.download_video">ä¸‹è½½è§†é¢‘</span>
                        </button>
                    </div>
                </div>
                
                <!-- ä»»åŠ¡åˆ—è¡¨ -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <h2 class="text-xl font-bold" data-translate="video_subtitle_remover.task_list">ä»»åŠ¡åˆ—è¡¨</h2>
                            <p class="text-sm text-gray-500 mt-1" data-translate="video_subtitle_remover.task_list_note">ä»…æ˜¾ç¤º24å°æ—¶å†…çš„æœ€æ–°1æ¡è®°å½•</p>
                        </div>
                        <div class="flex space-x-2">
                            <button id="clear-all-tasks-global-btn" class="text-red-600 hover:text-red-800 text-sm px-3 py-1 border border-red-300 rounded-md">
                                <i class="ri-delete-bin-line mr-1"></i><span data-translate="video_subtitle_remover.clear_all">æ¸…ç©ºæ‰€æœ‰</span>
                            </button>
                            <button id="refresh-history-btn" class="text-indigo-600 hover:text-indigo-800">
                                <i class="ri-refresh-line text-lg"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div id="history-container" class="space-y-4">
                        <div class="text-center py-8 text-gray-500">
                            <p data-translate="video_subtitle_remover.no_records">æš‚æ— è§†é¢‘å»å­—å¹•è®°å½•</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- åŠ è½½ä¸­é®ç½© -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-spinner"></div>
        <p class="text-xl mb-2" data-translate="video_subtitle_remover.processing_video">æ­£åœ¨å¤„ç†è§†é¢‘...</p>
        <p class="text-sm" data-translate="video_subtitle_remover.please_wait">è¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…</p>
    </div>

        <script>
        document.addEventListener('DOMContentLoaded', async function() {
            // åŠ è½½å¯¼èˆªæ ç»„ä»¶
            try {
                const navbarResponse = await fetch('/components/navbar-simple.html');
                const navbarHtml = await navbarResponse.text();
                document.getElementById('navbar-simple').innerHTML = navbarHtml;
                
                // åŠ è½½ç»„ä»¶JavaScript
                const componentsScript = document.createElement('script');
                componentsScript.src = '/components/components.js';
                document.head.appendChild(componentsScript);
            } catch (error) {
                console.error('åŠ è½½å¯¼èˆªæ å¤±è´¥:', error);
            }
            
            // è·å–é¡µé¢å…ƒç´ 
            const uploadArea = document.getElementById('upload-area');
            const videoUpload = document.getElementById('video-upload');
            const processBtn = document.getElementById('process-btn');
            const originalVideo = document.getElementById('original-video');
            const originalVideoWrapper = document.getElementById('original-video-wrapper');
            const originalVideoPlaceholder = document.getElementById('original-video-placeholder');
            const outputVideo = document.getElementById('output-video');
            const outputVideoWrapper = document.getElementById('output-video-wrapper');
            const outputVideoPlaceholder = document.getElementById('output-video-placeholder');
            const videoActions = document.getElementById('video-actions');
            const downloadBtn = document.getElementById('download-btn');
            const generationStatus = document.getElementById('generation-status');
            const progressBar = document.getElementById('progress-bar');
            const statusText = document.getElementById('status-text');
            const loadingOverlay = document.getElementById('loading-overlay');
            const historyContainer = document.getElementById('history-container');
            const refreshHistoryBtn = document.getElementById('refresh-history-btn');
             const videoDurationInfo = document.getElementById('video-duration-info');
             
             // ä¸Šä¼ ç›¸å…³å˜é‡
             let uploadedVideo = null;
             let uploadedVideoDuration = null; // ä¿å­˜è§†é¢‘å®é™…æ—¶é•¿
             
             // ä¸Šä¼ åŒºåŸŸç‚¹å‡»äº‹ä»¶
             uploadArea.addEventListener('click', () => {
                 videoUpload.click();
             });
             
             // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
             videoUpload.addEventListener('change', (e) => {
                 const file = e.target.files[0];
                 if (file) {
                     if (file.size > 200 * 1024 * 1024) {
                         alert(t('video_subtitle_remover.file_too_large'));
                         return;
                     }
                     
                     if (file.type !== 'video/mp4') {
                         alert(t('video_subtitle_remover.invalid_format'));
                         return;
                     }
                     
                     uploadedVideo = file;
                     const videoURL = URL.createObjectURL(file);
                     
                     originalVideo.src = videoURL;
                     originalVideoPlaceholder.style.display = 'none';
                     originalVideoWrapper.classList.remove('hidden');
                     
                    // ç›‘å¬è§†é¢‘å…ƒæ•°æ®åŠ è½½äº‹ä»¶ï¼Œè·å–è§†é¢‘æ—¶é•¿
                    originalVideo.onloadedmetadata = function() {
                        const duration = Math.round(originalVideo.duration);
                        const minutes = Math.floor(duration / 60);
                        const seconds = duration % 60;
                        const durationText = `${minutes}åˆ†${seconds}ç§’`;
                        
                        // ä¿å­˜è§†é¢‘æ—¶é•¿ï¼Œç”¨äºåç»­ä¸Šä¼ 
                        uploadedVideoDuration = duration;
                        
                        // æ˜¾ç¤ºè§†é¢‘æ—¶é•¿ä¿¡æ¯
                        if (videoDurationInfo) {
                            videoDurationInfo.innerHTML = `
                                <i class="ri-time-line mr-1"></i>
                                ${t('video_subtitle_remover.video_duration')}: ${durationText}
                            `;
                            videoDurationInfo.classList.remove('hidden');
                        }
                        
                        console.log(t('video_subtitle_remover.video_duration') + ':', durationText, 'åŸå§‹ç§’æ•°:', duration);
                    };
                 }
             });
             
             // æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½
             uploadArea.addEventListener('dragover', (e) => {
                 e.preventDefault();
                 uploadArea.classList.add('dragover');
             });
             
             uploadArea.addEventListener('dragleave', (e) => {
                 e.preventDefault();
                 uploadArea.classList.remove('dragover');
             });
             
             uploadArea.addEventListener('drop', (e) => {
                 e.preventDefault();
                 uploadArea.classList.remove('dragover');
                 
                 const file = e.dataTransfer.files[0];
                 if (file) {
                     // è§¦å‘æ–‡ä»¶é€‰æ‹©äº‹ä»¶
                     const dataTransfer = new DataTransfer();
                     dataTransfer.items.add(file);
                     videoUpload.files = dataTransfer.files;
                     
                     // æ‰‹åŠ¨è§¦å‘changeäº‹ä»¶
                     const event = new Event('change', { bubbles: true });
                     videoUpload.dispatchEvent(event);
                 }
             });
             
             // å¤„ç†æŒ‰é’®ç‚¹å‡»äº‹ä»¶
             if (processBtn) {
                 processBtn.addEventListener('click', async () => {
                     if (!uploadedVideo) {
                         alert(t('video_subtitle_remover.please_upload_video'));
                         return;
                     }
                     
                     try {
                         // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                         loadingOverlay.classList.remove('hidden');
                         generationStatus.classList.remove('hidden');
                         statusText.textContent = t('video_subtitle_remover.uploading_video');
                         progressBar.style.width = '10%';
                         
                        // å‡†å¤‡FormData
                        const formData = new FormData();
                        formData.append('video', uploadedVideo);
                        
                        // æ·»åŠ è§†é¢‘æ—¶é•¿ä¿¡æ¯
                        if (uploadedVideoDuration) {
                            formData.append('videoDuration', uploadedVideoDuration);
                            console.log('æ·»åŠ å®é™…è§†é¢‘æ—¶é•¿åˆ°è¯·æ±‚:', uploadedVideoDuration, 'ç§’');
                        }
                         
                         console.log(t('video_subtitle_remover.start_uploading'), {
                             fileName: uploadedVideo.name,
                             fileSize: (uploadedVideo.size / (1024 * 1024)).toFixed(2) + 'MB',
                             fileType: uploadedVideo.type
                         });
                         
                         // ä¸Šä¼ è§†é¢‘å¹¶åˆ›å»ºä»»åŠ¡
                         const response = await fetch('/api/video-subtitle-removal/create', {
                             method: 'POST',
                             headers: {
                                 'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                             },
                             body: formData
                         });
                         
                         const data = await response.json();
                         
                         if (!response.ok) {
                             if (response.status === 401) {
                                 statusText.innerHTML = 'è¯·å…ˆç™»å½•åå†ä½¿ç”¨æ­¤åŠŸèƒ½ <a href="/" class="text-blue-500 hover:underline">ç‚¹å‡»ç™»å½•</a>';
                                 return;
                             }
                             throw new Error(data.message || t('video_subtitle_remover.upload_failed'));
                         }
                         
                         console.log(t('video_subtitle_remover.success.upload') + 'ï¼Œä»»åŠ¡ID:', data.taskId);
                         
                         // æ·»åŠ å¤„ç†ä¸­çš„ä»»åŠ¡åˆ°å†å²è®°å½•
                         const processingItem = {
                             taskId: data.taskId,
                             status: 'PROCESSING',
                             originalVideoUrl: originalVideo.src,
                             createdAt: new Date().toISOString()
                         };
                         addToHistory(processingItem);
                         
                         // å¼€å§‹æ£€æŸ¥ä»»åŠ¡çŠ¶æ€
                         statusText.textContent = t('video_subtitle_remover.processing_video');
                         progressBar.style.width = '20%';
                         checkTaskStatus(data.taskId);
                         
                     } catch (error) {
                         console.error(t('video_subtitle_remover.upload_failed') + ':', error);
                         loadingOverlay.classList.add('hidden');
                         generationStatus.classList.add('hidden');
                         alert(t('video_subtitle_remover.upload_failed') + ': ' + error.message);
                     }
                 });
             }
             
            // æ˜¾ç¤ºè§†é¢‘
            function displayVideo(videoUrl) {
                outputVideo.src = videoUrl;
                outputVideoPlaceholder.classList.add('hidden');
                outputVideoWrapper.classList.remove('hidden');
                videoActions.classList.remove('hidden');
                
                // ä¸ºä¸‹è½½æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                if (downloadBtn && videoUrl) {
                    // ç§»é™¤ä¹‹å‰çš„äº‹ä»¶ç›‘å¬å™¨ï¼ˆå¦‚æœæœ‰ï¼‰
                    downloadBtn.replaceWith(downloadBtn.cloneNode(true));
                    const newDownloadBtn = document.getElementById('download-btn');
                    
                    newDownloadBtn.addEventListener('click', () => {
                        console.log('é¢„è§ˆåŒºåŸŸä¸‹è½½æŒ‰é’®è¢«ç‚¹å‡»ï¼Œ' + t('video_subtitle_remover.video_url_empty').split('ï¼Œ')[0] + ':', videoUrl);
                        
                        if (!videoUrl || !videoUrl.trim()) {
                            console.error(t('video_subtitle_remover.video_url_empty'));
                            alert(t('video_subtitle_remover.video_url_empty'));
                            return;
                        }
                        
                        try {
                            // ä½¿ç”¨ä»£ç†APIä¸‹è½½è§†é¢‘
                            const downloadUrl = `/api/video-subtitle-removal/download?url=${encodeURIComponent(videoUrl)}`;
                            console.log('ä½¿ç”¨ä¸‹è½½API:', downloadUrl);
                            
                            // åˆ›å»ºä¸€ä¸ªéšè—çš„ä¸‹è½½é“¾æ¥
                            const a = document.createElement('a');
                            a.href = downloadUrl;
                            a.download = t('video_subtitle_remover.download_filename'); // è®¾ç½®ä¸‹è½½æ–‡ä»¶å
                            
                            // æ·»åŠ åˆ°æ–‡æ¡£ä¸­
                            document.body.appendChild(a);
                            
                            // æ¨¡æ‹Ÿç‚¹å‡»
                            a.click();
                            console.log('ä¸‹è½½é“¾æ¥å·²ç‚¹å‡»');
                            
                            // ç§»é™¤ä¸‹è½½é“¾æ¥
                            setTimeout(() => {
                                document.body.removeChild(a);
                            }, 100);
                            
                            // æ˜¾ç¤ºæˆåŠŸæç¤º
                            showToast(t('video_subtitle_remover.download_started'), 'success');
                            
                        } catch (error) {
                            console.error(t('video_subtitle_remover.upload_failed') + ':', error);
                            // å¤‡ç”¨æ–¹æ¡ˆï¼šç›´æ¥åœ¨æ–°çª—å£æ‰“å¼€è§†é¢‘URL
                            window.open(videoUrl, '_blank');
                            showToast(t('video_subtitle_remover.open_in_new_window'), 'info');
                        }
                    });
                }
            }
            
            // æ˜¾ç¤ºè§†é¢‘é¢„è§ˆï¼ˆå…¨å±æ¨¡å¼ï¼‰
            function showVideoPreview(videoUrl) {
                // åˆ›å»ºæ¨¡æ€æ¡†
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="relative max-w-4xl max-h-full p-4">
                        <button class="absolute top-2 right-2 text-white hover:text-gray-300 text-2xl z-10" onclick="this.closest('.fixed').remove()">
                            <i class="ri-close-line"></i>
                        </button>
                        <video controls autoplay class="max-w-full max-h-full">
                            <source src="${videoUrl}" type="video/mp4">
                            ${t('video_subtitle_remover.video_not_supported')}
                        </video>
                    </div>
                `;
                
                // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
                
                // ESCé”®å…³é—­
                const handleEsc = (e) => {
                    if (e.key === 'Escape') {
                        modal.remove();
                        document.removeEventListener('keydown', handleEsc);
                    }
                };
                document.addEventListener('keydown', handleEsc);
                
                document.body.appendChild(modal);
            }
            
            // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
            function showToast(message, type = 'info') {
                const toast = document.createElement('div');
                let bgColor = 'bg-blue-500';
                let icon = 'ri-information-line';
                
                switch (type) {
                    case 'success':
                        bgColor = 'bg-green-500';
                        icon = 'ri-check-line';
                        break;
                    case 'error':
                        bgColor = 'bg-red-500';
                        icon = 'ri-close-line';
                        break;
                    case 'warning':
                        bgColor = 'bg-yellow-500';
                        icon = 'ri-alert-line';
                        break;
                }
                
                toast.className = `fixed top-4 right-4 ${bgColor} text-white px-4 py-2 rounded-lg shadow-lg z-50 flex items-center`;
                toast.innerHTML = `
                    <i class="${icon} mr-2"></i>
                    ${message}
                `;
                
                document.body.appendChild(toast);
                
                // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            }
            
            // æ£€æŸ¥ä»»åŠ¡çŠ¶æ€
            async function checkTaskStatus(taskId) {
                let retryCount = 0;
                const maxRetries = 3;
                let progress = 0;
                
                const interval = setInterval(async () => {
                    try {
                        const response = await fetch(`/api/video-subtitle-removal/status/${taskId}`, {
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                            }
                        });
                        
                        const data = await response.json();
                        
                        if (!response.ok) {
                            if (response.status === 401) {
                                clearInterval(interval);
                                statusText.innerHTML = 'è¯·å…ˆç™»å½•åå†ä½¿ç”¨æ­¤åŠŸèƒ½ <a href="/" class="text-blue-500 hover:underline">ç‚¹å‡»ç™»å½•</a>';
                                return;
                            }
                            throw new Error(data.message || t('video_subtitle_remover.error.processing_failed'));
                        }
                        
                        console.log('ä»»åŠ¡çŠ¶æ€å“åº”:', data);
                        
                        // è·å–å®é™…çš„ä»»åŠ¡çŠ¶æ€ - æœåŠ¡ç«¯è¿”å›åµŒå¥—çš„æ•°æ®ç»“æ„
                        const taskStatus = data.data ? data.data.status : data.status;
                        const taskResult = data.result || (data.data ? data.data.result : null);
                        
                        // çŠ¶æ€æ˜ å°„
                        let normalizedStatus = taskStatus;
                        if (taskStatus === 'SUCCEEDED' || taskStatus === 'PROCESS_SUCCESS' || taskStatus === 'Success') {
                            normalizedStatus = 'completed';
                        } else if (taskStatus === 'FAILED' || taskStatus === 'PROCESS_FAILED' || taskStatus === 'Failed') {
                            normalizedStatus = 'failed';
                        } else if (taskStatus === 'PROCESSING' || taskStatus === 'PROCESS_RUNNING' || taskStatus === 'RUNNING') {
                            normalizedStatus = 'processing';
                        } else if (taskStatus === 'PENDING') {
                            normalizedStatus = 'pending';
                        }
                        
                        // æ ¹æ®ä»»åŠ¡çŠ¶æ€å¤„ç†
                        switch (normalizedStatus) {
                            case 'completed':
                                clearInterval(interval);
                                loadingOverlay.classList.add('hidden');
                                generationStatus.classList.add('hidden');
                                
                                // è·å–è§†é¢‘URL - å…¼å®¹ä¸åŒçš„å“åº”æ ¼å¼
                                const videoUrl = taskResult?.videoUrl || data.data?.resultUrl || data.resultUrl;
                                if (videoUrl) {
                                    displayVideo(videoUrl);
                                } else {
                                    console.error('æœªæ‰¾åˆ°è§†é¢‘URL:', { taskResult, data });
                                    alert(t('video_subtitle_remover.error.processing_failed'));
                                    break;
                                }
                                
                                // ç«‹å³é‡æ–°åŠ è½½å†å²è®°å½•ä»¥æ˜¾ç¤ºæœ€æ–°çš„å®Œæˆä»»åŠ¡
                                console.log('âœ… ä»»åŠ¡å®Œæˆï¼Œç«‹å³åˆ·æ–°å†å²è®°å½•');
                                loadHistory();
                                
                                // å»¶è¿Ÿ2ç§’å†æ¬¡åˆ·æ–°ï¼Œç¡®ä¿OSSæ›´æ–°å·²å®Œæˆ
                                setTimeout(() => {
                                    console.log('ğŸ”„ å»¶è¿Ÿåˆ·æ–°å†å²è®°å½•ä»¥ç¡®ä¿æ˜¾ç¤ºæœ€æ–°çŠ¶æ€');
                                    loadHistory();
                                }, 2000);
                                break;
                                
                            case 'failed':
                                clearInterval(interval);
                                loadingOverlay.classList.add('hidden');
                                generationStatus.classList.add('hidden');
                                alert(t('video_subtitle_remover.error.processing_failed') + ': ' + (data.data?.message || data.message || data.error || 'æœªçŸ¥é”™è¯¯'));
                                
                                // ç«‹å³é‡æ–°åŠ è½½å†å²è®°å½•ä»¥æ˜¾ç¤ºæœ€æ–°çš„å¤±è´¥ä»»åŠ¡
                                console.log('âŒ ä»»åŠ¡å¤±è´¥ï¼Œç«‹å³åˆ·æ–°å†å²è®°å½•');
                                loadHistory();
                                
                                // å»¶è¿Ÿ2ç§’å†æ¬¡åˆ·æ–°ï¼Œç¡®ä¿OSSæ›´æ–°å·²å®Œæˆ
                                setTimeout(() => {
                                    console.log('ğŸ”„ å»¶è¿Ÿåˆ·æ–°å†å²è®°å½•ä»¥ç¡®ä¿æ˜¾ç¤ºæœ€æ–°çŠ¶æ€');
                                    loadHistory();
                                }, 2000);
                                break;
                                
                            case 'processing':
                                // æ›´æ–°è¿›åº¦æ¡
                                const serverProgress = data.data?.progress || 0;
                                if (serverProgress > 0) {
                                    progress = serverProgress;
                                } else {
                                    progress += 2; // æ¯5ç§’å¢åŠ 2%
                                    if (progress > 95) progress = 95; // æœ€å¤šåˆ°95%
                                }
                                progressBar.style.width = `${progress}%`;
                                statusText.textContent = t('video_subtitle_remover.processing');
                                break;
                                
                            default:
                                console.warn('æœªçŸ¥ä»»åŠ¡çŠ¶æ€:', normalizedStatus);
                        }
                        
                    } catch (error) {
                        console.error('æ£€æŸ¥ä»»åŠ¡çŠ¶æ€å‡ºé”™:', error);
                        retryCount++;
                        
                        if (error.message && error.message.includes('404')) {
                            console.log('ä»»åŠ¡ä¸å­˜åœ¨ï¼Œåœæ­¢è½®è¯¢');
                            clearInterval(interval);
                            loadingOverlay.classList.add('hidden');
                            generationStatus.classList.add('hidden');
                            alert(t('video_subtitle_remover.task_not_found'));
                            return;
                        }
                        
                        if (retryCount >= maxRetries) {
                            console.error(`ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢å¤±è´¥ï¼Œå·²é‡è¯•${maxRetries}æ¬¡`);
                            clearInterval(interval);
                            loadingOverlay.classList.add('hidden');
                            generationStatus.classList.add('hidden');
                            alert('ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚å¦‚æœé—®é¢˜æŒç»­å­˜åœ¨ï¼Œè¯·é‡æ–°ä¸Šä¼ è§†é¢‘ã€‚');
                        } else {
                            console.log(`ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢å¤±è´¥ï¼Œå°†è¿›è¡Œç¬¬${retryCount}æ¬¡é‡è¯•`);
                        }
                    }
                }, 5000);
            }
            
            // æ·»åŠ åˆ°å†å²è®°å½•
            function addToHistory(item) {
                let history = JSON.parse(localStorage.getItem('videoSubtitleRemovalHistory') || '[]');
                
                // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒä»»åŠ¡IDçš„è®°å½•
                const existingIndex = history.findIndex(h => h.taskId === item.taskId);
                if (existingIndex !== -1) {
                    // æ›´æ–°ç°æœ‰è®°å½•
                    history[existingIndex] = { ...history[existingIndex], ...item };
                } else {
                    // æ·»åŠ æ–°è®°å½•
                    history.unshift(item);
                }
                
                // åªä¿ç•™æœ€æ–°çš„10æ¡è®°å½•
                history = history.slice(0, 10);
                
                localStorage.setItem('videoSubtitleRemovalHistory', JSON.stringify(history));
                console.log('å†å²è®°å½•å·²æ›´æ–°:', item);
            }
            
            // åŠ è½½å†å²è®°å½•
            async function loadHistory() {
                try {
                    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
                    const authToken = localStorage.getItem('authToken');
                    if (!authToken) {
                        console.log('ç”¨æˆ·æœªç™»å½•ï¼Œä»localStorageåŠ è½½å†å²è®°å½•');
                        loadHistoryFromLocalStorage();
                        return;
                    }
                    
                    console.log('ä»æœåŠ¡å™¨åŠ è½½è§†é¢‘å»å­—å¹•å†å²è®°å½•...');
                    
                    // ä»åç«¯APIè·å–å†å²è®°å½•
                    const response = await fetch('/api/video-subtitle-removal/tasks', {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${authToken}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`æœåŠ¡å™¨è¿”å›é”™è¯¯: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (!data.success) {
                        throw new Error(data.error || 'è·å–å†å²è®°å½•å¤±è´¥');
                    }
                    
                    const history = data.data || data.tasks || [];
                    console.log(`ä»æœåŠ¡å™¨è·å–åˆ° ${history.length} æ¡å†å²è®°å½•`);
                    
                    renderHistory(history);
                    
                } catch (error) {
                    console.error('ä»æœåŠ¡å™¨åŠ è½½å†å²è®°å½•å¤±è´¥:', error);
                    console.log('å›é€€åˆ°localStorageåŠ è½½å†å²è®°å½•');
                    loadHistoryFromLocalStorage();
                }
            }
            
            // ä»localStorageåŠ è½½å†å²è®°å½•
            function loadHistoryFromLocalStorage() {
                const history = JSON.parse(localStorage.getItem('videoSubtitleRemovalHistory') || '[]');
                
                // è¿‡æ»¤24å°æ—¶å†…çš„è®°å½•
                const twentyFourHoursAgo = new Date(Date.now() - 24 * 60 * 60 * 1000);
                const recentHistory = history.filter(item => {
                    const itemDate = new Date(item.createdAt);
                    return itemDate >= twentyFourHoursAgo;
                });
                
                // åªä¿ç•™æœ€æ–°1æ¡è®°å½•
                const limitedHistory = recentHistory.slice(0, 1);
                
                console.log(`ä»localStorageè·å–åˆ° ${history.length} æ¡å†å²è®°å½•ï¼Œè¿‡æ»¤åæ˜¾ç¤º ${limitedHistory.length} æ¡`);
                renderHistory(limitedHistory);
            }
            
            // æ¸²æŸ“å†å²è®°å½•
            function renderHistory(history) {
                if (history.length === 0) {
                    historyContainer.innerHTML = '<div class="text-center py-8 text-gray-500"><p data-translate="common.no_tasks">æš‚æ— è§†é¢‘å»å­—å¹•è®°å½•</p></div>';
                    // é‡æ–°åº”ç”¨ç¿»è¯‘
                    updatePageLanguage();
                    return;
                }
                                
                historyContainer.innerHTML = '';
                
                history.forEach((item, index) => {
                    const taskElement = document.createElement('div');
                    taskElement.className = 'video-task bg-gray-50 p-4 rounded-lg border border-gray-200 mb-4';
                    taskElement.id = `task-${item.taskId || item.id}`;
                    
                    // é€‚é…ä¸åŒçš„æ•°æ®æºæ ¼å¼
                    const videoUrl = item.videoUrl;
                    const originalVideoUrl = item.originalVideoUrl;
                    const taskId = item.taskId || item.id;
                    
                    // çŠ¶æ€æ˜ å°„ - å°†åç«¯çŠ¶æ€æ˜ å°„ä¸ºå‰ç«¯æ ‡å‡†çŠ¶æ€
                    let taskStatus = item.status || 'SUCCEEDED';
                    let statusClass, statusText;
                    
                    if (item.status === 'SUCCEEDED' || item.status === 'PROCESS_SUCCESS' || item.status === 'Success') {
                        statusClass = 'bg-green-100 text-green-800';
                        statusText = translate('video_subtitle_remover.status.completed');
                    } else if (item.status === 'FAILED' || item.status === 'PROCESS_FAILED' || item.status === 'Failed') {
                        statusClass = 'bg-red-100 text-red-800';
                        statusText = translate('video_subtitle_remover.status.failed');
                    } else if (item.status === 'PROCESSING' || item.status === 'PROCESS_RUNNING' || item.status === 'RUNNING' || item.status === 'processing') {
                        statusClass = 'bg-blue-100 text-blue-800';
                        statusText = translate('video_subtitle_remover.status.processing');
                    } else if (item.status === 'PENDING' || item.status === 'pending') {
                        statusClass = 'bg-yellow-100 text-yellow-800';
                        statusText = translate('video_subtitle_remover.status.pending');
                    } else {
                        statusClass = 'bg-green-100 text-green-800';
                        statusText = translate('video_subtitle_remover.status.completed');
                    }
                    
                    console.log(`æ¸²æŸ“ä»»åŠ¡: taskId=${taskId}, åŸå§‹çŠ¶æ€=${item.status}, æ˜ å°„çŠ¶æ€=${taskStatus}, videoUrl=${videoUrl ? 'å­˜åœ¨' : 'ç¼ºå¤±'}`);
                    
                    // è§†é¢‘é¢„è§ˆï¼ˆä»…å½“ä»»åŠ¡æˆåŠŸä¸”æœ‰è§†é¢‘URLæ—¶ï¼‰
                    let videoPreview = '';
                    if ((item.status === 'SUCCEEDED' || item.status === 'PROCESS_SUCCESS' || item.status === 'Success') && videoUrl) {
                        videoPreview = `
                            <div class="mt-3">
                                <video controls class="w-full rounded" style="max-height: 180px">
                                    <source src="${videoUrl}" type="video/mp4">
                                    ${t('video_subtitle_remover.video_not_supported')}
                                </video>
                                <div class="flex justify-end mt-2">
                                    <a href="/api/video-subtitle-removal/download?url=${encodeURIComponent(videoUrl)}" class="text-indigo-600 hover:text-indigo-800 text-sm mr-3" download>
                                        <i class="ri-download-2-line mr-1"></i>${t('video_subtitle_remover.download')}
                                    </a>
                                    <button class="text-indigo-600 hover:text-indigo-800 text-sm preview-btn" data-url="${videoUrl}">
                                        <i class="ri-fullscreen-line mr-1"></i>${t('video_subtitle_remover.preview')}
                                    </button>
                                </div>
                            </div>
                        `;
                    } else if ((item.status === 'PROCESSING' || item.status === 'PROCESS_RUNNING' || item.status === 'RUNNING' || item.status === 'processing') && taskId) {
                        videoPreview = `
                            <div class="mt-3 flex justify-end">
                                <button class="check-status-btn text-blue-600 hover:text-blue-800 text-sm" data-task-id="${taskId}">
                                    <i class="ri-refresh-line mr-1"></i>æ£€æŸ¥çŠ¶æ€
                                </button>
                            </div>
                        `;
                    }
                    
                    // æ ¼å¼åŒ–æ—¶é—´æˆ³
                    const createdDate = new Date(item.createdAt);
                    const formattedDate = `${createdDate.getFullYear()}-${String(createdDate.getMonth() + 1).padStart(2, '0')}-${String(createdDate.getDate()).padStart(2, '0')} ${String(createdDate.getHours()).padStart(2, '0')}:${String(createdDate.getMinutes()).padStart(2, '0')}`;
                    
                    taskElement.innerHTML = `
                        <div class="flex justify-between">
                            <div class="flex-1 pr-4">
                                <p class="font-medium" data-translate="feature.video_subtitle_remover">è§†é¢‘å»é™¤å­—å¹•</p>
                                <div class="flex mt-2 text-sm text-gray-500">
                                    ${taskId ? `<span class="mr-4">${translate('common.task_id')}: ${taskId}</span>` : ''}
                                    <span>${formattedDate}</span>
                                </div>
                            </div>
                            <div>
                                <span class="px-2 py-1 text-xs rounded-full ${statusClass}">${statusText}</span>
                            </div>
                        </div>
                        ${videoPreview}
                    `;
                    
                    historyContainer.appendChild(taskElement);
                });
                
                // é‡æ–°åº”ç”¨ç¿»è¯‘åˆ°æ–°åˆ›å»ºçš„å…ƒç´ 
                updatePageLanguage();
                
                // æ·»åŠ é¢„è§ˆæŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
                document.querySelectorAll('.preview-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const videoUrl = btn.dataset.url;
                        showVideoPreview(videoUrl);
                    });
                });
                
                // æ·»åŠ çŠ¶æ€æ£€æŸ¥æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
                document.querySelectorAll('.check-status-btn').forEach(btn => {
                    btn.addEventListener('click', async () => {
                        const taskId = btn.dataset.taskId;
                        if (taskId) {
                            try {
                                const response = await fetch(`/api/video-subtitle-removal/status/${taskId}`, {
                                    headers: {
                                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                                    }
                                });
                                
                                if (response.ok) {
                                    const result = await response.json();
                                    console.log('ä»»åŠ¡çŠ¶æ€æ£€æŸ¥ç»“æœ:', result);
                                    
                                    // å¦‚æœä»»åŠ¡å·²å®Œæˆï¼Œåˆ·æ–°å†å²è®°å½•
                                    if (result.status === 'SUCCEEDED' || result.status === 'PROCESS_SUCCESS') {
                                        await loadHistory();
                                        showToast('ä»»åŠ¡å·²å®Œæˆï¼æ­£åœ¨åˆ·æ–°å†å²è®°å½•...', 'success');
                                    } else if (result.status === 'FAILED' || result.status === 'PROCESS_FAILED') {
                                        await loadHistory();
                                        showToast('ä»»åŠ¡å¤„ç†å¤±è´¥', 'error');
                                    } else {
                                        showToast(`ä»»åŠ¡çŠ¶æ€: ${result.status}`, 'info');
                                    }
                                } else {
                                    showToast('æ£€æŸ¥çŠ¶æ€å¤±è´¥', 'error');
                                }
                            } catch (error) {
                                console.error('æ£€æŸ¥çŠ¶æ€å‡ºé”™:', error);
                                showToast('æ£€æŸ¥çŠ¶æ€å‡ºé”™', 'error');
                            }
                        }
                    });
                });
            }
            
            // åˆ·æ–°å†å²è®°å½•æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            if (refreshHistoryBtn) {
                refreshHistoryBtn.addEventListener('click', function() {
                    loadHistory();
                });
            }
            
            // æ¸…ç©ºæ‰€æœ‰ä»»åŠ¡æŒ‰é’®äº‹ä»¶
            const clearAllTasksBtn = document.getElementById('clear-all-tasks-global-btn');
            if (clearAllTasksBtn) {
                clearAllTasksBtn.addEventListener('click', async function() {
                    console.log('æ¸…ç©ºæ‰€æœ‰ä»»åŠ¡æŒ‰é’®è¢«ç‚¹å‡»');
                    
                    // ç¡®è®¤å¯¹è¯æ¡†
                    if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è§†é¢‘å»å­—å¹•ä»»åŠ¡è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                        return;
                    }
                    
                    try {
                        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                        clearAllTasksBtn.disabled = true;
                        clearAllTasksBtn.innerHTML = '<i class="ri-loader-4-line animate-spin mr-1"></i>æ¸…ç©ºä¸­...';
                        
                        // è°ƒç”¨æ¸…ç©ºAPI
                        const response = await fetch('/api/video-subtitle-removal/clear-all-tasks', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                            }
                        });
                        
                        const result = await response.json();
                        console.log('æ¸…ç©ºä»»åŠ¡APIå“åº”:', result);
                        
                        if (response.ok && result.success) {
                            // æ¸…ç©ºæˆåŠŸï¼Œåˆ·æ–°ä»»åŠ¡åˆ—è¡¨
                            showToast('æ‰€æœ‰ä»»åŠ¡è®°å½•å·²æ¸…ç©º', 'success');
                            loadHistory();
                        } else {
                            throw new Error(result.error || 'æ¸…ç©ºå¤±è´¥');
                        }
                        
                    } catch (error) {
                        console.error('æ¸…ç©ºä»»åŠ¡å¤±è´¥:', error);
                        showToast('æ¸…ç©ºå¤±è´¥: ' + error.message, 'error');
                    } finally {
                        // æ¢å¤æŒ‰é’®çŠ¶æ€
                        clearAllTasksBtn.disabled = false;
                        clearAllTasksBtn.innerHTML = '<i class="ri-delete-bin-line mr-1"></i>æ¸…ç©ºæ‰€æœ‰';
                    }
                });
            }
            
            // é¡µé¢åŠ è½½æ—¶è·å–å†å²è®°å½•
            loadHistory();
            
            // åˆå§‹åŒ–ç¿»è¯‘ç³»ç»Ÿ
            if (typeof initializeTranslations === 'function') {
                initializeTranslations();
            }
        });
    </script>
</body>
</html> 