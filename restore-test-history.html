<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¢å¤Testè´¦æˆ·å†å²è®°å½•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background-color: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        .status.error {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        .status.info {
            background-color: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8">æ¢å¤Testè´¦æˆ·å†å²è®°å½•</h1>
        
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold mb-4">é—®é¢˜è¯´æ˜</h2>
            <p class="text-gray-700 mb-4">
                ç”±äºä¹‹å‰çš„ç”¨æˆ·çŠ¶æ€ç›‘å¬å‡½æ•°å­˜åœ¨bugï¼Œåœ¨ç”¨æˆ·åˆ‡æ¢æ—¶ä¼šé”™è¯¯åœ°æ¸…é™¤ä¹‹å‰ç”¨æˆ·çš„å†å²è®°å½•ã€‚
                è¿™ä¸ªå·¥å…·å¯ä»¥å¸®åŠ©æ¢å¤testè´¦æˆ·çš„å†å²è®°å½•ã€‚
            </p>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold mb-4">å½“å‰çŠ¶æ€</h2>
            <div id="current-status" class="status info">
                æ£€æŸ¥ä¸­...
            </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold mb-4">æ“ä½œ</h2>
            <div class="space-y-4">
                <button onclick="checkAllHistoryKeys()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    æ£€æŸ¥æ‰€æœ‰å†å²è®°å½•é”®
                </button>
                <button onclick="simulateTestUser()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    æ¨¡æ‹ŸTestç”¨æˆ·ç™»å½•
                </button>
                <button onclick="restoreTestHistory()" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">
                    æ¢å¤Testç”¨æˆ·å†å²è®°å½•
                </button>
                <button onclick="clearAllData()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                    æ¸…ç©ºæ‰€æœ‰æ•°æ®
                </button>
            </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-4">localStorageçŠ¶æ€</h2>
            <div id="localStorage-content" class="bg-gray-100 p-4 rounded text-sm font-mono">
                æš‚æ— æ•°æ®
            </div>
        </div>
    </div>

    <script>
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('current-status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        // æ›´æ–°localStorageæ˜¾ç¤º
        function updateLocalStorageDisplay() {
            const contentDiv = document.getElementById('localStorage-content');
            const allKeys = Object.keys(localStorage);
            const imageColorizationKeys = allKeys.filter(key => key.startsWith('imageColorizationHistory'));
            
            let content = 'æ‰€æœ‰localStorageé”®:\n\n';
            
            // æ˜¾ç¤ºæ‰€æœ‰é”®
            allKeys.forEach(key => {
                const value = localStorage.getItem(key);
                const isImageColorization = key.startsWith('imageColorizationHistory');
                const isUser = key === 'user';
                const isAuthToken = key === 'authToken';
                
                let icon = 'ğŸ“';
                if (isImageColorization) icon = 'ğŸ”‘';
                else if (isUser) icon = 'ğŸ‘¤';
                else if (isAuthToken) icon = 'ğŸ”';
                
                content += `${icon} ${key}:\n`;
                
                if (isImageColorization) {
                    try {
                        const history = value ? JSON.parse(value) : [];
                        content += `   è®°å½•æ•°é‡: ${history.length}\n`;
                        if (history.length > 0) {
                            content += `   æœ€æ–°è®°å½•: ${history[0].prompt || 'æ— æ ‡é¢˜'}\n`;
                            content += `   åˆ›å»ºæ—¶é—´: ${new Date(history[0].createdAt).toLocaleString()}\n`;
                        }
                    } catch (e) {
                        content += `   æ•°æ®æ ¼å¼é”™è¯¯\n`;
                    }
                } else if (isUser) {
                    try {
                        const user = value ? JSON.parse(value) : null;
                        if (user) {
                            content += `   ç”¨æˆ·ID: ${user.id || 'æœªçŸ¥'}\n`;
                            content += `   ç”¨æˆ·å: ${user.username || 'æœªçŸ¥'}\n`;
                            content += `   æ‰‹æœº: ${user.phone || 'æœªçŸ¥'}\n`;
                        }
                    } catch (e) {
                        content += `   æ•°æ®æ ¼å¼é”™è¯¯\n`;
                    }
                } else {
                    content += `   å€¼: ${value ? value.substring(0, 50) + '...' : 'null'}\n`;
                }
                content += '\n';
            });
            
            if (imageColorizationKeys.length === 0) {
                content += 'æ²¡æœ‰æ‰¾åˆ°å›¾åƒä¸Šè‰²å†å²è®°å½•é”®\n';
            }
            
            contentDiv.textContent = content;
        }

        // æ£€æŸ¥æ‰€æœ‰å†å²è®°å½•é”®
        function checkAllHistoryKeys() {
            updateStatus('æ£€æŸ¥æ‰€æœ‰å†å²è®°å½•é”®...', 'info');
            updateLocalStorageDisplay();
            
            const imageColorizationKeys = Object.keys(localStorage).filter(key => key.startsWith('imageColorizationHistory'));
            
            if (imageColorizationKeys.length > 0) {
                updateStatus(`æ‰¾åˆ° ${imageColorizationKeys.length} ä¸ªå†å²è®°å½•é”®`, 'success');
            } else {
                updateStatus('æ²¡æœ‰æ‰¾åˆ°ä»»ä½•å†å²è®°å½•é”®', 'error');
            }
        }

        // æ¨¡æ‹ŸTestç”¨æˆ·ç™»å½•
        function simulateTestUser() {
            const testUser = {
                id: 'test_user_123',
                username: 'test',
                phone: '13800138000'
            };
            
            localStorage.setItem('user', JSON.stringify(testUser));
            localStorage.setItem('authToken', 'token_test_' + Date.now());
            
            updateStatus('Testç”¨æˆ·å·²ç™»å½•', 'success');
            updateLocalStorageDisplay();
        }

        // æ¢å¤Testç”¨æˆ·å†å²è®°å½•
        function restoreTestHistory() {
            const testUser = {
                id: 'test_user_123',
                username: 'test',
                phone: '13800138000'
            };
            
            // è®¾ç½®Testç”¨æˆ·
            localStorage.setItem('user', JSON.stringify(testUser));
            
            // åˆ›å»ºTestç”¨æˆ·çš„å†å²è®°å½•
            const testHistoryKey = 'imageColorizationHistory_test_user_123';
            const testHistory = [
                {
                    originalImage: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=',
                    resultImage: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=',
                    prompt: 'Testç”¨æˆ·çš„å›¾åƒä¸Šè‰²è®°å½• - æ¢å¤æµ‹è¯•',
                    createdAt: new Date().toISOString()
                },
                {
                    originalImage: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=',
                    resultImage: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=',
                    prompt: 'Testç”¨æˆ·çš„ç¬¬äºŒå¼ å›¾åƒä¸Šè‰²è®°å½•',
                    createdAt: new Date(Date.now() - 3600000).toISOString() // 1å°æ—¶å‰
                }
            ];
            
            localStorage.setItem(testHistoryKey, JSON.stringify(testHistory));
            
            updateStatus('Testç”¨æˆ·å†å²è®°å½•å·²æ¢å¤', 'success');
            updateLocalStorageDisplay();
        }

        // æ¸…ç©ºæ‰€æœ‰æ•°æ®
        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                const keysToRemove = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && (key.startsWith('imageColorizationHistory') || key === 'user' || key === 'authToken')) {
                        keysToRemove.push(key);
                    }
                }
                
                keysToRemove.forEach(key => localStorage.removeItem(key));
                
                updateStatus('æ‰€æœ‰æ•°æ®å·²æ¸…ç©º', 'success');
                updateLocalStorageDisplay();
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ›´æ–°æ˜¾ç¤º
        window.addEventListener('load', function() {
            updateLocalStorageDisplay();
            checkAllHistoryKeys();
        });
    </script>
</body>
</html>

