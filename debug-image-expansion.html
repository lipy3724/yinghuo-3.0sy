<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½æ‰©å›¾ä¸Šä¼ è°ƒè¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            pointer-events: auto;
            z-index: 1;
        }
        .upload-area:hover {
            border-color: #6366f1;
            background-color: #f8faff;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.1);
        }
        .upload-area:active {
            transform: translateY(0);
        }
    </style>
</head>
<body class="min-h-screen bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-2xl font-bold mb-6">æ™ºèƒ½æ‰©å›¾ä¸Šä¼ åŠŸèƒ½è°ƒè¯•</h1>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- å·¦ä¾§ï¼šè°ƒè¯•ä¿¡æ¯ -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-bold mb-4">è°ƒè¯•ä¿¡æ¯</h2>
                
                <div class="space-y-4">
                    <div class="p-3 border rounded">
                        <h3 class="font-medium mb-2">é¡µé¢çŠ¶æ€</h3>
                        <div id="page-status" class="text-sm text-gray-600">
                            <p>é¡µé¢åŠ è½½ä¸­...</p>
                        </div>
                    </div>
                    
                    <div class="p-3 border rounded">
                        <h3 class="font-medium mb-2">DOMå…ƒç´ æ£€æŸ¥</h3>
                        <div id="dom-check" class="text-sm text-gray-600">
                            <p>æ£€æŸ¥ä¸­...</p>
                        </div>
                    </div>
                    
                    <div class="p-3 border rounded">
                        <h3 class="font-medium mb-2">äº‹ä»¶ç›‘å¬å™¨</h3>
                        <div id="event-status" class="text-sm text-gray-600">
                            <p>ç­‰å¾…æµ‹è¯•...</p>
                        </div>
                    </div>
                    
                    <div class="p-3 border rounded">
                        <h3 class="font-medium mb-2">æ§åˆ¶å°æ—¥å¿—</h3>
                        <div id="console-log" class="text-sm text-gray-600 bg-gray-100 p-2 rounded max-h-32 overflow-y-auto">
                            <p>ç­‰å¾…æ—¥å¿—...</p>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 space-y-2">
                    <button id="test-click" class="w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        æµ‹è¯•ç‚¹å‡»äº‹ä»¶
                    </button>
                    <button id="test-file-input" class="w-full bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                        æµ‹è¯•æ–‡ä»¶è¾“å…¥
                    </button>
                    <button id="clear-log" class="w-full bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">
                        æ¸…é™¤æ—¥å¿—
                    </button>
                </div>
            </div>
            
            <!-- å³ä¾§ï¼šä¸Šä¼ æµ‹è¯•åŒºåŸŸ -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-bold mb-4">ä¸Šä¼ æµ‹è¯•åŒºåŸŸ</h2>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">ä¸Šä¼ å›¾ç‰‡</label>
                    <div id="upload-area" class="upload-area h-36 flex flex-col items-center justify-center mb-2 bg-gray-50">
                        <i class="ri-upload-cloud-line text-2xl text-gray-400 mb-1"></i>
                        <p class="text-gray-500 text-center text-sm px-2">ç‚¹å‡»æˆ–è€…æ‹–åŠ¨æ–‡ä»¶åˆ°è¿™åŒºåŸŸæ¥ä¸Šä¼ </p>
                        <input type="file" id="image-upload" class="hidden" accept="image/*">
                    </div>
                    <p class="text-xs text-gray-500">æ”¯æŒJPGã€PNGã€WEBPæ ¼å¼ï¼Œæœ€å¤§10MB</p>
                </div>
                
                <div class="mb-4">
                    <h3 class="text-md font-medium mb-2">é¢„è§ˆåŒºåŸŸ</h3>
                    <div id="preview-container" class="bg-gray-100 rounded-md flex items-center justify-center overflow-hidden" style="min-height: 200px;">
                        <img id="preview-image" class="hidden max-w-full max-h-full object-contain" alt="é¢„è§ˆå›¾ç‰‡">
                        <p id="preview-placeholder" class="text-gray-500 text-center px-4">ä¸Šä¼ å›¾ç‰‡åå°†åœ¨è¿™é‡Œæ˜¾ç¤ºé¢„è§ˆ</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // é‡å†™console.logæ¥æ•è·æ—¥å¿—
        const originalLog = console.log;
        const originalError = console.error;
        const consoleLogDiv = document.getElementById('console-log');
        
        function addLog(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('p');
            logEntry.className = type === 'error' ? 'text-red-600' : 'text-gray-800';
            logEntry.textContent = `[${timestamp}] ${message}`;
            consoleLogDiv.appendChild(logEntry);
            consoleLogDiv.scrollTop = consoleLogDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog(args.join(' '), 'error');
        };
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
            
            const uploadArea = document.getElementById('upload-area');
            const imageUpload = document.getElementById('image-upload');
            const previewImage = document.getElementById('preview-image');
            const previewPlaceholder = document.getElementById('preview-placeholder');
            const testClickBtn = document.getElementById('test-click');
            const testFileInputBtn = document.getElementById('test-file-input');
            const clearLogBtn = document.getElementById('clear-log');
            
            // æ›´æ–°é¡µé¢çŠ¶æ€
            function updatePageStatus() {
                const pageStatus = document.getElementById('page-status');
                pageStatus.innerHTML = `
                    <p class="text-green-600">âœ… é¡µé¢å·²åŠ è½½</p>
                    <p class="text-xs text-gray-500">DOMContentLoaded äº‹ä»¶å·²è§¦å‘</p>
                `;
            }
            
            // æ£€æŸ¥DOMå…ƒç´ 
            function checkDOMElements() {
                const domCheck = document.getElementById('dom-check');
                const elements = {
                    'uploadArea': uploadArea,
                    'imageUpload': imageUpload,
                    'previewImage': previewImage,
                    'previewPlaceholder': previewPlaceholder
                };
                
                let html = '';
                for (const [name, element] of Object.entries(elements)) {
                    if (element) {
                        html += `<p class="text-green-600">âœ… ${name}: å­˜åœ¨</p>`;
                    } else {
                        html += `<p class="text-red-600">âŒ ${name}: ä¸å­˜åœ¨</p>`;
                    }
                }
                
                domCheck.innerHTML = html;
            }
            
            // æ›´æ–°äº‹ä»¶çŠ¶æ€
            function updateEventStatus(message) {
                const eventStatus = document.getElementById('event-status');
                eventStatus.innerHTML = `
                    <p class="text-blue-600">${message}</p>
                    <p class="text-xs text-gray-500">æ—¶é—´: ${new Date().toLocaleTimeString()}</p>
                `;
            }
            
            // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸ
            uploadArea.addEventListener('click', (e) => {
                console.log('âœ… ç‚¹å‡»ä¸Šä¼ åŒºåŸŸæˆåŠŸ');
                updateEventStatus('ç‚¹å‡»ä¸Šä¼ åŒºåŸŸäº‹ä»¶è§¦å‘');
                e.preventDefault();
                e.stopPropagation();
                imageUpload.click();
            });
            
            // æ–‡ä»¶é€‰æ‹©å˜åŒ–
            imageUpload.addEventListener('change', (e) => {
                const file = e.target.files[0];
                console.log('âœ… æ–‡ä»¶é€‰æ‹©å˜åŒ–:', file ? file.name : 'æ— æ–‡ä»¶');
                updateEventStatus(`æ–‡ä»¶é€‰æ‹©å˜åŒ–: ${file ? file.name : 'æ— æ–‡ä»¶'}`);
                
                if (file) {
                    handleImageFile(file);
                }
            });
            
            // æ‹–æ‹½ä¸Šä¼ 
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });
            
            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, unhighlight, false);
            });
            
            uploadArea.addEventListener('dragenter', (e) => {
                console.log('âœ… æ‹–æ‹½è¿›å…¥åŒºåŸŸ');
                updateEventStatus('æ‹–æ‹½è¿›å…¥åŒºåŸŸ');
            });
            
            uploadArea.addEventListener('dragover', (e) => {
                console.log('âœ… æ‹–æ‹½æ‚¬åœ');
                updateEventStatus('æ‹–æ‹½æ‚¬åœ');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                const dt = e.dataTransfer;
                const file = dt.files[0];
                console.log('âœ… æ–‡ä»¶æ‹–æ‹½é‡Šæ”¾:', file ? file.name : 'æ— æ–‡ä»¶');
                updateEventStatus(`æ–‡ä»¶æ‹–æ‹½é‡Šæ”¾: ${file ? file.name : 'æ— æ–‡ä»¶'}`);
                
                if (file && file.type.startsWith('image/')) {
                    handleImageFile(file);
                } else {
                    alert('è¯·ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼');
                }
            });
            
            function handleImageFile(file) {
                console.log('âœ… å¤„ç†æ–‡ä»¶:', file.name, file.type, file.size);
                
                // æ£€æŸ¥æ–‡ä»¶ç±»å‹
                if (!file.type.startsWith('image/')) {
                    alert('è¯·ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼æ”¯æŒçš„æ ¼å¼åŒ…æ‹¬JPGã€PNGå’ŒWEBP');
                    return;
                }
                
                // æ£€æŸ¥æ–‡ä»¶å¤§å°
                if (file.size > 10 * 1024 * 1024) {
                    alert('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡10MBï¼');
                    return;
                }
                
                // åˆ›å»ºé¢„è§ˆ
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = function() {
                        console.log('âœ… å›¾ç‰‡åŠ è½½æˆåŠŸ:', img.width, 'x', img.height);
                        
                        // æ˜¾ç¤ºé¢„è§ˆ
                        previewImage.src = event.target.result;
                        previewImage.classList.remove('hidden');
                        previewPlaceholder.classList.add('hidden');
                        
                        updateEventStatus(`å›¾ç‰‡é¢„è§ˆæˆåŠŸ: ${img.width} x ${img.height}`);
                        console.log('âœ… é¢„è§ˆæ˜¾ç¤ºæˆåŠŸ');
                    };
                    img.onerror = function() {
                        console.error('âŒ å›¾ç‰‡åŠ è½½å¤±è´¥');
                        updateEventStatus('å›¾ç‰‡åŠ è½½å¤±è´¥');
                        alert('å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œè¯·é‡æ–°ä¸Šä¼ ');
                    };
                    img.src = event.target.result;
                };
                reader.onerror = () => {
                    console.error('âŒ æ–‡ä»¶è¯»å–å¤±è´¥');
                    updateEventStatus('æ–‡ä»¶è¯»å–å¤±è´¥');
                    alert('è¯»å–æ–‡ä»¶å¤±è´¥ï¼Œè¯·é‡æ–°ä¸Šä¼ ');
                };
                reader.readAsDataURL(file);
            }
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            function highlight() {
                uploadArea.classList.add('border-indigo-500', 'bg-indigo-50');
            }
            
            function unhighlight() {
                uploadArea.classList.remove('border-indigo-500', 'bg-indigo-50');
            }
            
            // æµ‹è¯•æŒ‰é’®äº‹ä»¶
            testClickBtn.addEventListener('click', () => {
                console.log('ğŸ”§ æ‰‹åŠ¨æµ‹è¯•ç‚¹å‡»äº‹ä»¶');
                uploadArea.click();
            });
            
            testFileInputBtn.addEventListener('click', () => {
                console.log('ğŸ”§ æ‰‹åŠ¨æµ‹è¯•æ–‡ä»¶è¾“å…¥');
                imageUpload.click();
            });
            
            clearLogBtn.addEventListener('click', () => {
                consoleLogDiv.innerHTML = '<p>æ—¥å¿—å·²æ¸…é™¤</p>';
            });
            
            // åˆå§‹åŒ–
            updatePageStatus();
            checkDOMElements();
            updateEventStatus('äº‹ä»¶ç›‘å¬å™¨å·²è®¾ç½®');
            
            console.log('âœ… è°ƒè¯•é¡µé¢åˆå§‹åŒ–å®Œæˆ');
        });
    </script>
</body>
</html> 